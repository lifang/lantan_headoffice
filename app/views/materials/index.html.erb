<% direction ||= 'none' %>
<% column ||= 'none' %>
<div class="box">
  <div class="data_box">
    <div class="data_menu">
      <% if permission?(:logistics_manage, :storage) %><a id="ruku_a" href="JavaScript:void(0)">入库</a><% end %>
      <% if permission?(:logistics_manage, :print_list) %><a href="/materials/m_list" target="_blank">打印库存清单</a><% end %>
    </div>
    <div class="clear"></div>
    <div class="tab_head">
      <ul>
        <li class="hover">库存列表</li>
        <% if permission?(:logistics_manage, :out_record) %><li>出库记录</li><% end %>
        <% if permission?(:logistics_manage, :in_record) %><li>入库记录</li><% end %>
        <li>门店订货记录</li>
      </ul>
    </div>
    <div id="table_show" class="data_body">
      <div id="materials_tab">    <!--库存列表-->
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table">
          <thead>
            <tr class="hbg">
              <td>条形码</td>
              <td><span class="sort_<%= column=="name" ? direction : "asc" %>"  data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="name">物料名称</span></td>
              <td><span class="sort_<%= column=="types" ? direction : "asc" %>" data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="types">物料类别</span></td>
              <td>库存状态</td>
              <td>库存量（个）</td>
              <td>成本价（元）</td>
              <td>盘点实数</td>
              <td>操作</td>
            </tr>
          </thead>
          <tbody>
            <% @materials.each do |material| %>
              <tr>
                <td <% if material.storage <= 0 %>class="data_table_error"<% end %>><%= material.code %></td>
                <td><%= material.name %></td>
                <td><% Material::TYPES_NAMES.each do |key, value| %><% if key == material.types %><%= value %><% end %><% end %></td>
                <td>存货</td>
                <td><%= material.storage %></td>
                <td><%= material.price %></td>
                <td><input type="text" value="<%= material.storage %>" style="width:50px"/></td>
                <td>
                  <input type="hidden" value="<%= material.id %>"/>
                  <a name="material_beizhu" href="JavaScript:void(0)" class="bz_btn">备注</a>
                  <a name="material_check" href="JavaScript:void(0)">核实</a>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <div class="pageTurn">
          <% if !@materials.blank? %>
            <%= will_paginate  @materials, :previous_label => "上一页", :next_label=> "下一页", :class => "pageTurn" %>
          <% end %>
        </div>
      </div>

      <div id="mat_out_tab" style="display:none;">  <!--出库记录-->
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table">
          <thead>
            <tr class="hbg">
              <td>订货单号</td>
              <td>条形码</td>
      <td><span class="sort_<%= column=="name" ? direction : "asc" %>"  data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="name">物料名称</span></td>
      <td><span class="sort_<%= column=="types" ? direction : "asc" %>" data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="types">物料类别</span></td>
              <td>库存量（个）</td>
            </tr>
          </thead>
          <tbody>
            <% @mat_out_orders.each do |moo| %>
            <tr>
              <td>
                <input type="hidden" value="<%= moo.material_order.nil? ? "" : moo.material_order.id %>"/>
                <a href="JavaScript:void(0)" name="mat_order_detail" class="other_a"><%= moo.material_order.nil? ? "------" : moo.material_order.code %></a>
              </td>
              <td><%= moo.material.code if !moo.material.nil? %></td>
              <td><%= moo.material.name if !moo.material.nil? %></td>
              <td><% Material::TYPES_NAMES.each do |key, value| %><% if key == moo.material.types %><%= value %><% end %><% end %></td>
              <td><%= moo.material.storage %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
        <div class="pageTurn">
           <% if !@mat_out_orders.blank? %>
            <%= will_paginate  @mat_out_orders, :previous_label => "上一页", :next_label=> "下一页", :class => "pageTurn" %>
          <% end %>
        </div>
      </div>

      <div id="mat_in_tab" style="display:none;"> <!--入库记录-->
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table">
          <thead>
            <tr class="hbg">
              <td>条形码</td>
              <td><span class="sort_<%= column=="name" ? direction : "asc" %>"  data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="name">物料名称</span></td>
              <td><span class="sort_<%= column=="types" ? direction : "asc" %>" data-link="<%= materials_url %>" onclick="orderMaterial(this)" data-name="types">物料类别</span></td>
              <td>入库量</td>
              <td>操作人</td>
              <td>入库时间</td>
            </tr>
          </thead>
          <tbody>
            <% @mat_in_orders.each do |mio| %>
            <tr>
              <td><%= mio.material.code if mio.material %></td>
              <td><%= mio.material.name if mio.material%></td>
              <td><% Material::TYPES_NAMES.each do |key, value| %><% if key == mio.material.types %><%= value %><% end %><% end %></td>
              <td><%= mio.material_num %></td>
              <td>
                <% if mio.staff %>
                <%= mio.staff.name %>
                <% else %>
                ----
                <% end %>
              </td>
              <td><%= mio.created_at.strftime("%Y-%m-%d")  %></td>
            </tr>
           <% end %>
          </tbody>
        </table>
        <div class="pageTurn">
          <% if !@mat_in_orders.blank? %>
            <%= will_paginate  @mat_in_orders, :previous_label => "上一页", :next_label=> "下一页", :class => "pageTurn" %>
          <% end %>
        </div>
      </div>

      <div style="display:none;"> <!--门店订货记录-->
        <div class="search">
          <div><label>状态：</label>
            <select id="select_mo_status" name="select_mo_status">
              <option value="999">全部</option>
              <% MaterialOrder::STATUS.each do |key, value| %>
              <option value="<%= key %>"><%= value %></option>
              <% end %>
            </select>
          </div>
          <div><label>时间：</label>
            <input name="started_time" type="text" id="started_time" readonly/> 到
            <input name="ended_time" type="text" id="ended_time" readonly/>
          </div>
          <div><button id="mo_search_button" class="search_btn">查询</button></div>
        </div>
        <div id="mat_orders_tab">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table">
          <thead>
            <tr class="hbg">
              <td>订货单号</td>
              <td>详细内容</td>
              <td>门店名称</td>
              <td>总价</td>
              <td>订货时间</td>
              <td>预计到货时间</td>
              <td>物流状态</td>
              <td>物流信息</td>
              <td>付款状态</td>
              <td>操作</td>
            </tr>
          </thead>
          <tbody>
            <% @mat_orders.each do |mo| %>
            <tr>
              <td><%= mo.code %></td>
              <td>
                <table width="100%" border="0" cellspacing="1" cellpadding="0" class="s_table">
                  <tr class="fws">
                    <td>名称</td>
                    <td>单价</td>
                    <td>数量</td>
                  </tr>
                  <% if mo.mat_order_items.blank? %>
                  <tr>
                    <td colspan="3">------</td>
                  </tr>
                  <% else %>
                  <% mo.mat_order_items.each do |moi| %>
                  <tr>
                    <td><%= moi.material.try(:name) %></td>
                    <td><%= moi.price %></td>
                    <td><%= moi.material_num %></td>
                  </tr>
                  <% end %>
                  <% end %>
                </table>
              </td>
              <td>               
                <%= mo.store.nil? ? "------" : mo.store.name %>
              </td>
              <td>             
                <%= mo.price ||= "------"%>
              </td>
              <td><%= mo.created_at.strftime("%Y-%m-%d") %></td>
              <td id="arrival_at<%= mo.id %>">
                <%= mo.arrival_at.nil? ? "------" : mo.arrival_at.strftime("%Y-%m-%d")   %>
              </td>
              <td id="mo_status<%= mo.id %>">
                <% if mo.m_status.nil? %>
                未知
                <% else %>
                <% MaterialOrder::M_STATUS.each do |key, value| %>
                 <% if mo.m_status == key %>
                  <%= value %>
                 <% end %>
                <% end %>
                <% end %>
              </td>
              <td id="logi_info<%= mo.id %>">物流单号:<%= mo.logistics_code ||= "-----" %><br/>承运人：<%= mo.carrier ||= "-----" %></td>
              <td>
                <% if mo.status.nil? %>
                未知
                <% else %>
                  <% MaterialOrder::STATUS.each do |key, value| %>
                    <% if mo.status == key %>
                      <%= value %>
                    <% end %>
                  <% end %>
                <% end %>
              </td>
              <td>
                <input type="hidden" value="<%= mo.id %>"/>
                <a name="mat_order_detail" href="JavaScript:void(0)">详情</a>
                <a name="mat_order_beizhu" href="JavaScript:void(0)">备注</a>
              </td>
            </tr>
            <% end %>
          </tbody>
        </table>
        <div class="pageTurn">
          <% if !@mat_orders.blank? %>
            <%= will_paginate  @mat_orders, :previous_label => "上一页", :next_label=> "下一页", :class => "pageTurn" %>
          <% end %>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="beizhu_area" class="tab_popup beizhu_tab">    <!--备注-->
</div>
<div id="order_detail" class="tab_popup" style="display: none;"> <!--订单详情-->
</div>
<div id="ruku" class="tab_popup" style="display: none;"> <!--入库-->
    <div class="popup_box">
      <h1>入库<a id="ruku_cancel_x" href="JavaScript:void(0)" class="close">关闭</a></h1>
      <div class="popup_body">
        <div class="popup_body_area">
          <div class="item">
            <label>物料名称：</label><input id="m_name" name="m_name" type="text"/>
          </div>
          <div class="item">
            <label>物料类别：</label><select id="m_type" name="m_type">
              <% Material::TYPES_NAMES.each do |key, value| %>
                <option value="<%= key %>"><%= value %></option>
              <% end %>
            </select>
          </div>
          <div class="item">
            <label>条形码：</label><input id="m_code" name="m_code" type="text"/>
          </div>
          <div class="item">
            <label>单价：</label><input id="m_price" name="m_price" type="text"/>
          </div>
          <div class="item">
            <label>数量：</label><input id="m_num" name="m_num" type="text"/>
          </div>
        </div>
        <div class="btn_box">
          <button id="ruku_btn" class="confirm_btn">确定</button>
        </div>
        <div class="clear"></div>
      </div>
    </div>
</div>